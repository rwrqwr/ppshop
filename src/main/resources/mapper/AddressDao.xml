<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fff.dao.AddressDao">
    <insert id="addAddress">
        INSERT INTO address_info (address_ad, user_id, address_status, tel_phone, receiver_name)
        VALUES (#{address.addressAd}, (SELECT user_id
                                       FROM user_info
                                       WHERE user_tel = #{userTel}), #{address.addressStatus}, #{address.telPhone},
                #{address.receiverName});
    </insert>

    <update id="updateAddress">
        UPDATE address_info
        SET address_status = (CASE WHEN address_id = #{addressId} AND user_id = (SELECT user_id FROM user_info WHERE user_tel=#{userTel})
                                  THEN 1
                              WHEN user_id = (SELECT user_id FROM user_info WHERE user_tel=#{userTel}) AND address_status = 1
                                  THEN 0
                              ELSE address_status
                              END);
    </update>


    <select id="queryByUserTel" resultType="com.fff.entity.Address">
        SELECT
            address_id,
            address_ad,
            address_status,
            tel_phone,
            receiver_name
        FROM address_info
        WHERE user_id = (SELECT user_id
                         FROM user_info
                         WHERE user_tel = #{userTel});
    </select>


</mapper>